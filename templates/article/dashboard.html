<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard - My Blog</title>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@500;700&family=Open+Sans&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">

<style>
body {
    background-color: #121212;
    font-family: 'Open Sans', sans-serif;
    color: #E0E0E0;
}

nav {
    background: rgba(30, 30, 30, 0.85);
    backdrop-filter: blur(12px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
}

.brand-logo {
    font-family: 'Roboto', sans-serif;
    font-weight: 700;
    color: #FFD600 !important;
}

nav a {
    color: #FFD600 !important;
    font-weight: 500;
}

.container {
    margin-top: 32px;
}

.card {
    border-radius: 18px;
    background: rgba(40, 40, 40, 0.85);
    backdrop-filter: blur(12px);
    box-shadow: 0 12px 32px rgba(0,0,0,0.6);
    padding: 24px;
    margin-bottom: 24px;
}

.card-title {
    font-family: 'Roboto', sans-serif;
    font-weight: 700;
    color: #FFD600;
    font-size: 1.6rem;
}

.card-content p {
    color: #CCCCCC;
    font-size: 1rem;
    margin-bottom: 12px;
}

.btn-glass {
    background: rgba(255, 214, 0, 0.15);
    color: #FFD600;
    border-radius: 999px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    transition: all 0.2s;
    padding: 0 16px;
    margin-right: 8px;
}

.btn-glass:hover {
    background: rgba(255, 214, 0, 0.3);
    color: #FFF700;
}
</style>
</head>

<body>

<!-- NAVBAR -->
<nav>
    <div class="nav-wrapper container">
        <a href="/" class="brand-logo">MyBlog</a>
        <a href="#" data-target="mobile-menu" class="sidenav-trigger">
            <i class="material-icons">menu</i>
        </a>
        <ul class="right hide-on-med-and-down" id="navbar-links">
            <li><a href="/articles/create" class="btn btn-glass">Добавить статью</a></li>
            <li><a href="/logout" class="btn btn-glass">Выйти</a></li>
        </ul>
    </div>
</nav>

<!-- MOBILE MENU -->
<ul class="sidenav" id="mobile-menu">
    <li><a href="/articles/create" class="btn btn-glass">Добавить статью</a></li>
    <li><a href="/logout" class="btn btn-glass">Выйти</a></li>
</ul>

<div class="container">
    <h2 style="color: #FFD600; margin-bottom: 24px;">Мои Статьи</h2>
    <div id="articles-container"></div>
</div>

<!-- Materialize JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        M.Sidenav.init(document.querySelectorAll('.sidenav'));
    
        const articlesPerPage = 4;
        let currentPage = 1;
        let articles = [];
    
        async function loadDashboard() {
            try {
                const res = await fetch("/api/dashboard", { credentials: 'include' });
                if (!res.ok) throw new Error("Ошибка загрузки");
    
                const data = await res.json();
                articles = data.articles;
    
                renderArticles();
                renderPagination();
            } catch (e) {
                console.error(e);
            }
        }
    
        function renderArticles() {
            const container = document.getElementById("articles-container");
            container.innerHTML = "";
    
            if (articles.length === 0) {
                container.innerHTML = `<p style="color:#CCCCCC;">У тебя нет записей.</p>`;
                return;
            }
    
            const start = (currentPage - 1) * articlesPerPage;
            const end = start + articlesPerPage;
            const pageArticles = articles.slice(start, end);
    
            pageArticles.forEach(article => {
                const card = document.createElement("div");
                card.className = "card hoverable";
                card.innerHTML = `
                    <div class="card-content">
                        <span class="card-title">${article.title}</span>
                        <div>
                            <a href="/articles/edit?id=${article.id}" class="btn btn-glass">Edit</a>
                            <a href="/articles/delete?id=${article.id}" class="btn btn-glass">Delete</a>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }
    
        function renderPagination() {
            let pagination = document.getElementById("pagination");
            if (!pagination) {
                pagination = document.createElement("div");
                pagination.id = "pagination";
                pagination.style.marginTop = "20px";
                pagination.style.textAlign = "center";
                document.querySelector(".container").appendChild(pagination);
            }
    
            const totalPages = Math.ceil(articles.length / articlesPerPage);
            pagination.innerHTML = `
                <button class="btn btn-glass" ${currentPage === 1 ? 'disabled' : ''} id="prevBtn">Previous</button>
                <span style="margin: 0 10px; color:#FFD600;">${currentPage} / ${totalPages}</span>
                <button class="btn btn-glass" ${currentPage === totalPages ? 'disabled' : ''} id="nextBtn">Next</button>
            `;
    
            document.getElementById("prevBtn").onclick = () => {
                if (currentPage > 1) {
                    currentPage--;
                    renderArticles();
                    renderPagination();
                }
            };
            document.getElementById("nextBtn").onclick = () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    renderArticles();
                    renderPagination();
                }
            };
        }
    
        loadDashboard();
    });
    </script>
    

</body>
</html>
