<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Create Article - My Blog</title>

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@500;700&family=Open+Sans&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">

<style>
body {
    background-color: #121212;
    font-family: 'Open Sans', sans-serif;
    color: #E0E0E0;
}
nav {
    background: rgba(30, 30, 30, 0.85);
}
.brand-logo {
    font-family: 'Roboto', sans-serif;
    font-weight: 700;
    color: #FFD600 !important;
}
.container {
    margin-top: 64px;
    max-width: 600px;
}
.card {
    border-radius: 18px;
    background: rgba(40, 40, 40, 0.85);
    padding: 32px;
}
label {
    color: #FFD600;
}
input, textarea, select {
    color: #E0E0E0;
}
.btn-glass {
    width: 100%;
    background: rgba(255,214,0,0.15);
    color: #FFD600;
    border-radius: 999px;
}
</style>
</head>

<body>

<nav>
    <div class="nav-wrapper container">
        <a href="/" class="brand-logo">MyBlog</a>
    </div>
</nav>

<div class="container">
    <div class="card">
        <h4 class="center-align" style="color:#FFD600">Create Article</h4>

        <form id="articleForm">
            <label>Title</label>
            <input type="text" name="title" required>

            <label>Anons</label>
            <input type="text" name="anons" required>

            <label>Full Text</label>
            <textarea id="editor"></textarea>

            <label>Image</label>
            <input type="file" name="image">

            <label>Category</label>
            <select id="categorySelect" name="category_id">
                <option value="">Loading...</option>
            </select>

            <br><br>
            <button type="submit" class="btn btn-glass">Create</button>
        </form>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
<script src="https://cdn.ckeditor.com/ckeditor5/39.0.1/classic/ckeditor.js"></script>

<script>
let editor;

/* CKEditor */
ClassicEditor
    .create(document.querySelector('#editor'))
    .then(e => editor = e);

/* Загрузка категорий */
async function loadCategories() {
    const res = await fetch("/api/categories", { credentials: "include" });
    const categories = await res.json();

    const select = document.getElementById("categorySelect");
    select.innerHTML = `<option value="">-- Select Category --</option>`;

    categories.forEach(c => {
        select.innerHTML += `<option value="${c.id}">${c.name}</option>`;
    });

    M.FormSelect.init(select);
}

/* Отправка статьи */
document.getElementById("articleForm").addEventListener("submit", async e => {
    e.preventDefault();

    const formData = new FormData();
    formData.append("title", e.target.title.value);
    formData.append("anons", e.target.anons.value);
    formData.append("full_text", editor.getData());

    if (e.target.image.files[0]) {
        formData.append("image", e.target.image.files[0]);
    }

    if (e.target.category_id.value) {
        formData.append("category_id", e.target.category_id.value);
    }

    const res = await fetch("/api/articles/create", {
        method: "POST",
        body: formData,
        credentials: "include"
    });

    if (res.ok) {
        window.location.href = "/dashboard";
    } else {
        alert("Failed to create article");
    }
});

document.addEventListener("DOMContentLoaded", loadCategories);
</script>

</body>
</html>
